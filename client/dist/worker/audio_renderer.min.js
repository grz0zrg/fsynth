var sine_lookup_size=8192,sine_lookup_size_m1=sine_lookup_size-1,sine_lookup=new Float32Array(sine_lookup_size),sine_lookup_phase=0,sine_lookup_phase_step=2*Math.PI/sine_lookup_size,s=0,oscillators=[];for(s=0;s<sine_lookup_size;s+=1)sine_lookup[s]=Math.sin(sine_lookup_phase),sine_lookup_phase+=sine_lookup_phase_step;self.onmessage=function(s){"use strict";var e,o,a,i=s.data,t=i.sample_rate,p=i.data[0],_=1/(i.options.sps?i.options.sps:60),n=Math.round(_*t),l=null,r=null,h=0,u=0,k=0,d=0,f=0,g=0,M=0,c=0,v=1/n,z=0,m=null,b=16.34,y=0,x=0,F=0;M=0;for(o=i.options.octaves?i.height/i.options.octaves:i.height/10,i.options.baseFrequency&&(b=i.options.baseFrequency),x=0;x<i.height;x+=1)a=b*Math.pow(2,x/o)/t*sine_lookup_size,oscillators[i.height-1-x]={phase_step:a,phase_index:Math.random()*sine_lookup_size_m1};l=[],r=[];for(c=0;;){for(h=0,u=0,x=0;x<p.length;x+=1)e=p[x],m=oscillators[e.y],F=sine_lookup[m.phase_index&sine_lookup_size_m1],h+=(e.pl+e.dl*y)*F,u+=(e.pr+e.dr*y)*F,m.phase_index+=m.phase_step;if(l[c]=h,r[c]=u,k+=Math.abs(h),d+=Math.abs(u),f=Math.max(h,f),g=Math.max(u,g),y+=v,(z+=1)>=n){if(y=0,z=0,(M+=1)===i.data.length)break;p=i.data[M]}c+=1}var w=l.length,A=1-f,q=1-g;for(c=0;c<w;c+=1)l[c]/=A,r[c]/=q;var I=0;if(w>32)for(c=0;c<8;c+=1)l[c]*=I,r[c]*=I,l[w-c-1]*=I,r[w-c-1]*=I,I+=1/8;k/=w,d/=w;var P=new Float32Array(l),j=new Float32Array(r);postMessage({uid:i.uid,length:w,data_l:P,data_r:j,avg_l:k,avg_r:d,opts:i.options},[P.buffer,j.buffer])};