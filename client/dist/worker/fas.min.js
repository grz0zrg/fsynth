var _fas_timeout,_fas=!1,_fas_ws=null,_FAS_ENABLE=0,_FAS_DISABLE=1,_FAS_BANK_INFOS=2,_FAS_SYNTH_INFOS=3,_FAS_FRAME=4,_FAS_CHN_INFOS=5,_FAS_CHN_FX_INFOS=6,_FAS_ACTION=7,_FAS_INSTRUMENT_INFOS=8,_FAS_ACTION_RELOAD=0,_FAS_ACTION_RETRIGGER=1,_FAS_ACTION_FAUST_GENS_RELOAD=2,_FAS_ACTION_FAUST_EFFS_RELOAD=3,_FAS_ACTION_PAUSE=4,_FAS_ACTION_PLAY=5,_FAS_ACTION_WAVES_RELOAD=6,_FAS_ACTION_IMPULSES_RELOAD=7,_fas_queue=[],_fas_queue_timeout=null,_fas_queue_timeout_ms=2e3,_appendBuffer=function(e,_){var n=new Uint8Array(e.byteLength+_.byteLength);return n.set(new Uint8Array(e),0),n.set(new Uint8Array(_),e.byteLength),n.buffer},_getBankInfosBuffer=function(e){if(!(e.h<=0||e.octaves<=0||e.base_freq<=0)){var _=new ArrayBuffer(32),n=new Uint8Array(_,0,1),t=new Uint32Array(_,8,3),a=new Float64Array(_,24);return n[0]=0,t[0]=e.h,t[1]=e.octaves,t[2]=!0===e.float_data?1:0,a[0]=e.base_freq,_}},_getSynthInfosBuffer=function(e){var _=new ArrayBuffer(24),n=new Uint8Array(_,0,1),t=new Uint8Array(_,8,1),a=new Float64Array(_,16,1);return n[0]=2,t[0]=e.target,a[0]=e.value,_},_sendBankInfos=function(e){if(_fas)try{_fas_ws.send(_getBankInfosBuffer(e))}finally{}},_sendSynthInfos=function(e){if(_fas)try{_fas_ws.send(_getSynthInfosBuffer(e))}finally{}},_sendAction=function(e){if(_fas){var _,n,t;e.type===_FAS_ACTION_RELOAD||e.type===_FAS_ACTION_FAUST_GENS_RELOAD||e.type===_FAS_ACTION_FAUST_EFFS_RELOAD||e.type===_FAS_ACTION_PAUSE||e.type===_FAS_ACTION_PLAY||e.type===_FAS_ACTION_WAVES_RELOAD||e.type===_FAS_ACTION_IMPULSES_RELOAD?(_=new ArrayBuffer(8),(n=new Uint8Array(_,0,2))[0]=5,n[1]=e.type):e.type===_FAS_ACTION_RETRIGGER&&(_=new ArrayBuffer(16),n=new Uint8Array(_,0,2),t=new Uint32Array(_,8,2),n[0]=5,n[1]=e.type,t[0]=e.instrument,t[1]=e.note);try{_fas_ws.send(_)}finally{}}},_sendInstrInfos=function(e){if(_fas){var _=new ArrayBuffer(24),n=new Uint8Array(_,0,1),t=new Uint32Array(_,8,2),a=new Float64Array(_,16,1);n[0]=6,t[0]=e.instrument,t[1]=e.target,a[0]=e.value;try{_fas_ws.send(_)}finally{}}},_sendChnInfos=function(e){if(_fas){var _=new ArrayBuffer(24),n=new Uint8Array(_,0,1),t=new Uint32Array(_,8,2),a=new Float64Array(_,16,1);n[0]=3,t[0]=e.chn,t[1]=e.target,a[0]=e.value;try{_fas_ws.send(_)}finally{}}},_sendChnFxInfos=function(e){if(_fas){var _=new ArrayBuffer(32),n=new Uint8Array(_,0,1),t=new Uint32Array(_,8,3),a=new Float64Array(_,24,1);n[0]=4,t[0]=e.chn,t[1]=e.slot,t[2]=e.target,a[0]=e.value;try{_fas_ws.send(_)}finally{}}},_sendFrame=function(e,_){if(1===_fas_ws.readyState){var n,t,a,s,r,f;if(r=_?16+4*(n=new Float32Array(e[0])).length*e.length:16+(n=new Uint8Array(e[0])).length*e.length,t=new ArrayBuffer(r),a=new Uint8Array(t,0,1),s=new Uint32Array(t,8,1),f=0,a[0]=1,s[0]=e.length,_)for(f=0;f<e.length;f+=1)(a=new Float32Array(t,16+4*n.length*f,n.length)).set(new Float32Array(e[f]));else for(f=0;f<e.length;f+=1)(a=new Uint8Array(t,16+n.length*f,n.length)).set(new Uint8Array(e[f]));try{_fas_ws.send(t)}finally{}}},_disconnect=function(){_fas_ws&&_fas_ws.close(4e3),clearTimeout(_fas_timeout),_fas_ws=null},_connect=function(e){(_fas_ws=new WebSocket("ws://"+e.address)).binaryType="arraybuffer",_fas_ws.onopen=function(){postMessage({status:"open"})},_fas_ws.onerror=function(e){postMessage({status:"error"})},_fas_ws.onmessage=function(e){var _=new Int32Array(e.data),n=new Float64Array(e.data,8);0===_[0]&&postMessage({status:"streaminfos",load:_[1],latency:n[0]})},_fas_ws.onclose=function(_){_fas&&4e3!==_.code&&(postMessage({status:"close"}),clearTimeout(_fas_timeout),_fas_timeout=setTimeout(_connect,5e3,e))}},_fetchQueue=function(){if(_fas)if(1!==_fas_ws.readyState)_fas_queue_timeout=setTimeout(_fetchQueue,_fas_queue_timeout_ms);else{for(var e=0;e<_fas_queue.length;e+=1)self.onmessage(_fas_queue[e]);_fas_queue=[]}};self.onmessage=function(e){"use strict";var _=e.data,n=_.cmd,t=_.arg;if(!0===_fas&&n!==_FAS_ENABLE&&n!==_FAS_FRAME&&n!==_FAS_DISABLE&&null!==_fas_ws&&1!==_fas_ws.readyState)return _fas_queue.push(e),clearTimeout(_fas_queue_timeout),void(_fas_queue_timeout=setTimeout(_fetchQueue,_fas_queue_timeout_ms));n===_FAS_ENABLE?(_fas=!0,_fas_ws||_connect(t)):n===_FAS_DISABLE?(_fas=!1,_disconnect(),clearTimeout(_fas_queue_timeout),_fas_queue=[]):n===_FAS_BANK_INFOS?_sendBankInfos(t):n===_FAS_SYNTH_INFOS?_sendSynthInfos(t):n===_FAS_FRAME?_sendFrame(t,_.float):n===_FAS_CHN_INFOS?_sendChnInfos(t):n===_FAS_CHN_FX_INFOS?_sendChnFxInfos(t):n===_FAS_ACTION?_sendAction(t):n===_FAS_INSTRUMENT_INFOS&&_sendInstrInfos(t)};