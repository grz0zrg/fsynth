self.onmessage=function(a){"use strict";var e,t,r,d,n,f,o,s,l,i,p,u=a.data.score_height,w=new Float32Array(5*u),y=0,A=0,c=u-1,g=0;for(a.data.float?(e=new Float32Array(a.data.prev_data),t=new Float32Array(a.data.data),o=1):(e=new Uint8ClampedArray(a.data.prev_data),t=new Uint8ClampedArray(a.data.data),o=1/255),s=t.length,l=0;l<s;l+=4){if(r=e[l+0],d=e[l+1],n=t[l+0],f=t[l+1],n>0||f>0)i=n*o,p=f*o,y=r*o,A=d*o,w[g]=c,w[g+1]=y,w[g+2]=A,w[g+3]=i-y,w[g+4]=p-A;else{if(!(r>0||d>0)){c-=1;continue}y=r*o,A=d*o,w[g]=c,w[g+1]=y,w[g+2]=A,w[g+3]=-y,w[g+4]=-A}c-=1,g+=5}postMessage({d:w.buffer},[w.buffer])};